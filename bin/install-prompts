#!/usr/bin/env bash
#
# Configures VS Code settings for prompt files locations in Codespaces

set -euo pipefail

# shellcheck source=../lib/utils.sh
source "$(dirname "${BASH_SOURCE[0]}")/../lib/utils.sh"
dotfiles_dir=$(get_dotfiles_dir "${BASH_SOURCE[0]}")

vscode_settings_dir="$HOME/.vscode-remote/data/Machine"
settings_file="$vscode_settings_dir/settings.json"

mkdir -p "$vscode_settings_dir"

echo -n "Configuring VS Code settings for prompt files ..."
if [ -f "$settings_file" ]; then
    # Merge with existing settings
    jq -s '.[0] * .[1]' "$settings_file" <(echo "{
        \"chat.promptFilesLocations\": {
            \"$dotfiles_dir/prompts\": true
        }
    }") > "$settings_file.tmp"
    mv "$settings_file.tmp" "$settings_file"
else
    cat > "$settings_file" << EOF
{
    "chat.promptFilesLocations": {
        "$dotfiles_dir/prompts": true
    }
}
EOF
fi
echo "done"
