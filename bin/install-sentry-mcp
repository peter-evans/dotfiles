#!/usr/bin/env bash
#
# Installs Sentry MCP server configuration for VS Code in Codespaces

set -euo pipefail

# shellcheck source=../lib/utils.sh
source "$(dirname "${BASH_SOURCE[0]}")/../lib/utils.sh"
dotfiles_dir=$(get_dotfiles_dir "${BASH_SOURCE[0]}")
mcp_config_dir="$HOME/.vscode-remote/data/User"
mcp_config_file="$mcp_config_dir/mcp.json"

mkdir -p "$mcp_config_dir"

echo -n "Configuring mcp.json ..."
if [ -f "$mcp_config_file" ]; then
    # Merge with existing configuration
    jq -s '.[0] * .[1]' "$mcp_config_file" "$dotfiles_dir/sentry-mcp.json" > "$mcp_config_file.tmp"
    mv "$mcp_config_file.tmp" "$mcp_config_file"
else
    cp "$dotfiles_dir/sentry-mcp.json" "$mcp_config_file"
fi
echo "done"
